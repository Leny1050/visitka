<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>ИИ чат-бот | ShineSwa</title>
  <style>
    body { font-family: Arial; background: #222; color: #fff; }
    .container {
      width: 450px; margin: 50px auto; padding: 20px;
      background: #333; border-radius: 10px; box-shadow: 0 5px 10px rgba(0,0,0,0.5);
    }
    #chat { height: 400px; overflow-y: auto; padding: 10px; }
    .user, .bot { padding: 8px; margin: 10px; border-radius: 5px; max-width: 80%; }
    .user { background: #555; text-align: right; float: right; clear: both; }
    .bot { background: #FFD700; color: black; text-align: left; float: left; clear: both; }
    input, button {
      width: 100%; padding: 10px; border-radius: 5px; margin-top: 10px; border: none; outline: none;
    }
    button { background: #FFD700; cursor: pointer; font-weight: bold; }
  </style>
</head>
<body>
<div class="container">
  <h2>ИИ чат-бот ShineSwa</h2>
  <div id="chat"></div>
  <input type="text" id="question" placeholder="Задай вопрос...">
  <button onclick="askBot()">Отправить</button>
</div>

<script>
  let knowledgeBase = {};

  fetch('knowledge_base.json').then(res => res.json()).then(data => knowledgeBase = data);

  function showMessage(msg, sender){
    const div = document.createElement('div');
    div.className = sender;
    div.textContent = msg;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  async function askBot(){
    const question = document.getElementById('question').value.trim();
    if (!question) return;
    
    showMessage(question, 'user');
    document.getElementById('question').value = '';
    
    const lowerQuestion = question.toLowerCase();
    let found = false;

    for(let key in knowledgeBase){
      if(lowerQuestion.includes(key)){
        showMessage(knowledgeBase[key], 'bot');
        found = true;
        break;
      }
    }

    if (!found) {
      showMessage('Секунду, думаю...', 'bot');

      const siteInfo = Object.values(knowledgeBase).join(' ');
      const prompt = `На основе информации "${siteInfo}" ответь на вопрос "${question}" коротко и ясно.`;

      const response = await fetch('https://api-inference.huggingface.co/models/EleutherAI/gpt-neo-1.3B',{
        headers: {'Content-Type':'application/json'},
        method:'POST',
        body: JSON.stringify({inputs:prompt, parameters:{max_length:150,temperature:0.7}})
      });

      const result = await response.json();

      if(result && result[0]){
        const botAnswer = result[0].generated_text.replace(prompt, '').trim();
        chat.lastChild.textContent = botAnswer;
      } else {
        chat.lastChild.textContent = "Извините, произошла ошибка, попробуйте позже.";
      }
    }
  }

  document.getElementById('question').addEventListener('keypress', function(e){
    if (e.key === 'Enter') askBot();
  });

  showMessage('Привет! Чем могу помочь?', 'bot');
</script>
</body>
</html>